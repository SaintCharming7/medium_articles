#install.packages(c("ggplot2", "remotes","wid","dplyr","tidyr", "tidyverse", "readr", "ggthemes"))
# Load the required libraries for this exercise
#library("input name of the package")
# Or you can choose the method below for a cleaner look in the script
package_list<- c("ggplot2","dplyr","tidyr", "tidyverse", "readr", "ggthemes")
lapply(package_list, require, character.only = TRUE)


palma_ratio <- read_csv("palma-ratio.csv")
View(palma_ratio)
str(palma_ratio)

# Define a list of interesting countries to compare
key_countries <- c("Brazil", "United States", "India", "Germany", "South Africa", "China", "Sweden")

# Filter and plot
palma_ratio %>%
  filter(Country %in% key_countries) %>%
  ggplot(aes(x = Year, y = `Palma ratio (before tax) (World Inequality Database)`, 
             color = Country, group = Country)) +
  geom_line(size = 1.2, alpha = 0.8) +
  geom_point(size = 1.5) +
  labs(
    title = "Evolution of Income Inequality (Palma Ratio)",
    subtitle = "Ratio of richest 10% share to poorest 40% share - Before Tax",
    y = "Palma Ratio",
    x = "Year",
    caption = "Source: World Inequality Database via Our World in Data"
  ) +
  theme_classic() + # Or try theme_minimal(), theme_fivethirtyeight()
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom")

# Filter data from 2001 onwards
palma_filtered <- palma_ratio %>%
  filter(Year >= 2001)

# Find top 5 countries with highest average inequality
top_countries <- palma_filtered %>%
  group_by(Country) %>%
  summarise(avg_inequality = mean(`Palma ratio (before tax) (World Inequality Database)`, na.rm = TRUE)) %>%
  arrange(desc(avg_inequality)) %>%
  head(5) %>%
  pull(Country)

# Filter data for only the top 5 countries
top_countries_data <- palma_filtered %>%
  filter(Country %in% top_countries)

# Create line plot
ggplot(top_countries_data, 
       aes(x = Year, 
           y = `Palma ratio (before tax) (World Inequality Database)`, 
           color = Country,
           group = Country)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  labs(title = "Top 5 Countries with Highest Palma Ratio (2001 onwards)",
       x = "Year",
       y = "Palma Ratio (before tax)",
       color = "Country") +
  theme_classic() +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0.5, face = "bold")) +
  scale_x_continuous(breaks = seq(2001, max(top_countries_data$Year), by = 2))

